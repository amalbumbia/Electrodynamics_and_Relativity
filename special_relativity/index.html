<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Special Relativity Tutorial</title>

<style>
  :root { --accent:#2f6feb; --text:#111; --bg:#fff; }
  * { box-sizing: border-box; }
  body { margin:0; font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:var(--bg); }
  header { padding:1rem 1.2rem; border-bottom:1px solid #e5e7eb; position:sticky; top:0; background:#fff; z-index:10; }
  header h1 { font-size:1.1rem; margin:0 0 .2rem; }
  main { max-width: 1100px; margin: 1rem auto; padding: 0 1rem 4rem; }
  .controls { display:flex; gap:1rem; align-items:center; font-size:.95rem; color:#444; }
  .controls label { display:flex; align-items:center; gap:.5rem; }
  .page { position: relative; margin: 24px auto; box-shadow: 0 8px 30px rgba(0,0,0,.06); background:#fff; }
  canvas.pdf-page { width: 100%; height: auto; display:block; }
  .hotspot { position:absolute; border:2px solid rgba(47,111,235,.35); background:rgba(47,111,235,.08); border-radius:10px; cursor:pointer; }
  .hotspot.hidden { border-color: transparent; background: transparent; }
  .hotspot:focus-visible { outline:3px solid #2f6feb66; outline-offset:2px; }
  .popover { position:absolute; max-width:360px; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:.8rem 1rem; box-shadow:0 12px 34px rgba(0,0,0,.14); z-index:999; }
  .popover h4 { margin:.1rem 0 .4rem; font-size:1rem; }
  .popover .close { appearance:none; border:0; background:transparent; font-size:1.1rem; position:absolute; right:.5rem; top:.35rem; cursor:pointer; }
  .legend { font-size:.9rem; color:#555; margin:.35rem 0 0; }
  a { color: var(--accent); }
  .footnote { margin-top:1rem; font-size:.9rem; color:#666; }
</style>

<!-- MathJax for LaTeX in popovers -->
<script>window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] } };</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- PDF.js from CDN (worker + main library) -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.min.js";
</script>
</head>
<body>
<header>
  <h1>Interactive Special Relativity Tutorial</h1>
  <div class="controls">
    <label><input type="checkbox" id="toggleBoxes" checked /> Show highlight boxes</label>
    <span class="legend">Click highlighted regions for explanations. Press <kbd>Esc</kbd> to close.</span>
  </div>
</header>
<main id="viewer"></main>
<div class="footnote" style="max-width:1100px;margin:0 auto;padding:0 1rem 2rem;">
  Tip: adjust hotspot rectangles in the <code>annotations</code> array below to fine‑tune placement.
</div>

<script>
/* ========= 1) CONFIG =========
   Put the PDF next to this HTML file and set the relative path here.
*/
const pdfUrl = "special_relativity/Special_Relativity_Tutorial.pdf";

/* ========= 2) ANNOTATIONS =========
   Popovers as rectangles (x,y,w,h) normalized to the page width/height (0..1), per 1-based page.
   Initial guesses provided—tweak after viewing.
*/
const annotations = [
  // Page 1 — Core definitions & setup
  { page: 1, rect: { x: 0.10, y: 0.22, w: 0.30, h: 0.08 },
    title: "Event",
    html: "An <b>event</b> is a point in spacetime with coordinates $[x,y,z,t]$ (a four‑vector)."
  },
  { page: 1, rect: { x: 0.55, y: 0.28, w: 0.30, h: 0.08 },
    title: "Invariant",
    html: "An <b>invariant</b> is a quantity that remains the same under a transformation (e.g., between inertial frames)."
  },
  { page: 1, rect: { x: 0.12, y: 0.44, w: 0.34, h: 0.10 },
    title: "Worldline",
    html: "A <b>worldline</b> is the sequence of events traced by a particle through spacetime."
  },
  { page: 1, rect: { x: 0.52, y: 0.48, w: 0.34, h: 0.10 },
    title: "Light cone",
    html: "At any event, the <b>light cone</b> contains all possible lightlike paths through that event."
  },

  // Page 2 — Frames & Galilean transform
  { page: 2, rect: { x: 0.10, y: 0.18, w: 0.34, h: 0.10 },
    title: "Reference frame (RF)",
    html: "An RF is a framework with synchronized clocks for consistent measurements. <i>Inertial</i> RFs obey Newton's first law."
  },
  { page: 2, rect: { x: 0.55, y: 0.54, w: 0.34, h: 0.10 },
    title: "Galilean transform (fails for light)",
    html: "For low speeds: $x'=x-vt$. But composing velocities $v'=v-V$ breaks light‑speed invariance, motivating Lorentz transforms."
  },

  // Page 3–4 — Time notions
  { page: 3, rect: { x: 0.10, y: 0.20, w: 0.36, h: 0.12 },
    title: "Coordinate time $\\Delta t$",
    html: "Time between events measured by synchronized clocks in a given frame. It is <i>frame‑dependent</i>."
  },
  { page: 4, rect: { x: 0.55, y: 0.20, w: 0.36, h: 0.12 },
    title: "Proper time $\\Delta T$",
    html: "Time measured by a single clock present at both events. Frame‑independent but <i>path‑dependent</i>."
  },
  { page: 4, rect: { x: 0.12, y: 0.62, w: 0.36, h: 0.12 },
    title: "Spacetime interval $\\Delta s$",
    html: "For inertial worldlines: $$\\Delta s^2 = -\\Delta t^2+\\Delta x^2+\\Delta y^2+\\Delta z^2$$ (with $c=1$)."
  },

  // Page 5 — Lorentz + consequences
  { page: 5, rect: { x: 0.10, y: 0.16, w: 0.38, h: 0.12 },
    title: "Lorentz factor",
    html: "$$\\gamma=\\frac{1}{\\sqrt{1-v^2}}\\ge1$$ (using $c=1$)."
  },
  { page: 5, rect: { x: 0.54, y: 0.18, w: 0.38, h: 0.14 },
    title: "Lorentz transform",
    html: "$$t' = \\gamma (t - vx),\\quad x' = \\gamma (x - vt)$$"
  },
  { page: 5, rect: { x: 0.10, y: 0.56, w: 0.36, h: 0.12 },
    title: "Time dilation",
    html: "$$\\Delta t = \\gamma\\,\\Delta t'$$"
  },
  { page: 5, rect: { x: 0.55, y: 0.60, w: 0.36, h: 0.12 },
    title: "Length contraction",
    html: "$$L' = \\frac{L}{\\gamma}$$ (parallel to motion)."
  },

  // Page 6 — Metric tensor
  { page: 6, rect: { x: 0.10, y: 0.20, w: 0.42, h: 0.16 },
    title: "Metric (Minkowski)",
    html: "Signature $(-,+,+,+)$. $$\\eta_{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$$"
  },
  { page: 6, rect: { x: 0.56, y: 0.50, w: 0.36, h: 0.16 },
    title: "Interval via metric",
    html: "$$\\Delta s^2 = \\eta_{\\mu\\nu}\\,\\Delta x^\\mu\\,\\Delta x^\\nu$$"
  }
];

const viewer = document.getElementById('viewer');
const toggleBoxes = document.getElementById('toggleBoxes');
let openPopover = null;

function closePopover(){
  if(openPopover){ openPopover.remove(); openPopover = null; }
}
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closePopover(); });

function makePopover(container, x, y, title, html){
  closePopover();
  const pop = document.createElement('div');
  pop.className = 'popover';
  pop.innerHTML = `<button class="close" aria-label="Close">×</button><h4>${title}</h4><div class="content">${html}</div>`;
  pop.querySelector('.close').addEventListener('click', closePopover);
  container.appendChild(pop);

  // place near click, keep within container
  const rect = container.getBoundingClientRect();
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
  const left = clamp(x + 12, 8, rect.width - 372);
  const top  = clamp(y + 12, 8, rect.height - 200);
  pop.style.left = left + "px";
  pop.style.top  = top  + "px";
  openPopover = pop;
  if(window.MathJax) MathJax.typesetPromise([pop]);
}

toggleBoxes.addEventListener('change', ()=>{
  document.querySelectorAll('.hotspot').forEach(hs=>{
    hs.classList.toggle('hidden', !toggleBoxes.checked);
  });
});

async function renderPDF(){
  try {
    const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
    for(let p=1; p<=pdf.numPages; p++){
      const page = await pdf.getPage(p);
      // Render at a base width; you can tweak scale for sharper canvases
      const viewport = page.getViewport({ scale: 1.5 });
      const wrapper = document.createElement('div');
      wrapper.className = 'page';
      wrapper.style.width = viewport.width + "px";
      wrapper.style.height = viewport.height + "px";
      wrapper.setAttribute('role','group');
      wrapper.setAttribute('aria-label', `Page ${p}`);
      viewer.appendChild(wrapper);

      const canvas = document.createElement('canvas');
      canvas.className = 'pdf-page';
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      wrapper.appendChild(canvas);

      const ctx = canvas.getContext('2d', { alpha:false });
      await page.render({ canvasContext: ctx, viewport }).promise;

      // Add hotspots for this page
      const pageAnn = annotations.filter(a => a.page === p);
      pageAnn.forEach(a=>{
        const hs = document.createElement('button');
        hs.className = 'hotspot';
        hs.setAttribute('aria-label', a.title);
        hs.style.left = (a.rect.x * viewport.width) + "px";
        hs.style.top  = (a.rect.y * viewport.height) + "px";
        hs.style.width  = (a.rect.w * viewport.width) + "px";
        hs.style.height = (a.rect.h * viewport.height) + "px";
        hs.addEventListener('click', (evt)=>{
          const r = wrapper.getBoundingClientRect();
          makePopover(wrapper, evt.clientX - r.left, evt.clientY - r.top, a.title, a.html);
        });
        wrapper.appendChild(hs);
      });
    }
  } catch(err){
    viewer.innerHTML = `<p style="color:#b00">Failed to load PDF: ${err.message}</p><p>Ensure <code>Special_Relativity_Tutorial.pdf</code> is in the same folder as this HTML.</p>`;
  }
}

renderPDF();
</script>
</body>
</html>
