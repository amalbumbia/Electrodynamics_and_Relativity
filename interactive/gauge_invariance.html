<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../assets/header-css.css">
  <link rel="stylesheet" href="../assets/mainStyle.css">

<title>Gauge Invariance</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#111}
  header{padding:12px 16px;border-bottom:1px solid #ddd}
  h1{margin:0;font-size:16px}
  .wrap{display:grid;grid-template-columns:280px 1fr;gap:12px;padding:12px}
  .panel{border:1px solid #ddd;border-radius:8px;background:#fff}
  .panel h2{margin:0;padding:8px 10px;border-bottom:1px solid #eee;font-size:14px}
  .panel .body{padding:10px}
  label{display:block;font-size:12px;margin:6px 0 4px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type=range]{width:100%}
  input,select,button{font-size:12px}
  button.btn{padding:6px 10px;border:1px solid #ccc;background:#f5f5f5;border-radius:6px;cursor:pointer}
  button.btn[aria-pressed="true"]{background:#e0e0e0}
  #E0,#kVal{width:72px}
  .plots{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .plot-card{padding:10px}
  canvas{width:100%;height:220px;display:block}
  .legend{font-size:12px;color:#444;margin-top:4px}
  @media (max-width: 900px){.wrap{grid-template-columns:1fr}.plots{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <h1>Gauge Invariance</h1>
  </header>

  <main class="wrap">
    <!-- Controls -->
    <section class="panel">
      <h2>Controls</h2>
      <div class="body">
        <label>Time
          <input id="tRange" type="range" min="0" max="6.28318530718" step="0.001" value="0" />
        </label>
        <div class="row">
          <button id="playBtn" class="btn" aria-pressed="false">Play</button>
          <label>Speed
            <input id="speed" type="number" min="0.1" step="0.1" value="1.0" />
          </label>
        </div>
        <div class="row">
          <label>E₀
            <input id="E0" type="number" step="0.1" value="1.0" />
          </label>
          <label>k
            <input id="kVal" type="number" step="0.1" value="1.0" />
          </label>
        </div>
      </div>
    </section>

    <!-- Two gauge panels -->
    <section class="plots">
      <!-- Coulomb panel -->
      <div class="panel">
        <h2>Coulomb gauge</h2>
        <div class="body">
          <div class="row">
            <label>View
              <select id="viewC">
                <option value="fields">Fields</option>
                <option value="potentials">Potentials</option>
              </select>
            </label>
            <label id="fieldSelC">Show
              <select id="fieldWhichC">
                <option value="Ey">Ey</option>
                <option value="Bz">Bz</option>
              </select>
            </label>
            <label id="potSelC" style="display:none">Quantity
              <select id="potWhichC">
                <option value="V">V</option>
                <option value="Ax">Ax</option>
                <option value="Ay">Ay</option>
              </select>
            </label>
          </div>
        </div>
        <div class="plot-card">
          <canvas id="canvasC" width="1000" height="240"></canvas>
          <div class="legend"><span id="legendC">E — Coulomb</span></div>
        </div>
      </div>

      <!-- Lorenz panel -->
      <div class="panel">
        <h2>Lorenz gauge</h2>
        <div class="body">
          <div class="row">
            <label>View
              <select id="viewL">
                <option value="fields">Fields</option>
                <option value="potentials">Potentials</option>
              </select>
            </label>
            <label id="fieldSelL">Show
              <select id="fieldWhichL">
                <option value="Ey">Ey</option>
                <option value="Bz">Bz</option>
              </select>
            </label>
            <label id="potSelL" style="display:none">Quantity
              <select id="potWhichL">
                <option value="V">V</option>
                <option value="Ax">Ax</option>
                <option value="Ay">Ay</option>
              </select>
            </label>
          </div>
        </div>
        <div class="plot-card">
          <canvas id="canvasL" width="1000" height="240"></canvas>
          <div class="legend"><span id="legendL">E — Lorenz</span></div>
        </div>
      </div>
    </section>
  </main>

<script>
(() => {
  // colors, basic setup
  const COL = { grid:'#eee', zero:'#ccc', E:'#1f77b4', B:'#2ca02c', POT:'#c0392b' };
  const c = 1.0; // c=1
  const TWO_PI = Math.PI*2;
  const state = { t:0, E0:1.0, k:1.0, get w(){return c*this.k}, get alpha(){return this.E0/(this.w*this.k)}, playing:false, last:performance.now(), speed:1.0 };

  // DOM controls
  const tRange = document.getElementById('tRange');
  const playBtn= document.getElementById('playBtn');
  const speedEl= document.getElementById('speed');
  const E0El   = document.getElementById('E0');
  const kEl    = document.getElementById('kVal');

  // Coulomb panel DOM
  const viewC = document.getElementById('viewC');
  const fieldSelC = document.getElementById('fieldSelC');
  const potSelC   = document.getElementById('potSelC');
  const fieldWhichC = document.getElementById('fieldWhichC');
  const potWhichC   = document.getElementById('potWhichC');
  const canvasC     = document.getElementById('canvasC');
  const legendC     = document.getElementById('legendC');
  const ctxC        = canvasC.getContext('2d');

  // Lorenz panel DOM
  const viewL = document.getElementById('viewL');
  const fieldSelL = document.getElementById('fieldSelL');
  const potSelL   = document.getElementById('potSelL');
  const fieldWhichL = document.getElementById('fieldWhichL');
  const potWhichL   = document.getElementById('potWhichL');
  const canvasL     = document.getElementById('canvasL');
  const legendL     = document.getElementById('legendL');
  const ctxL        = canvasL.getContext('2d');

  // x grid
  const N=700, xMin=-2*Math.PI, xMax=2*Math.PI; const xs=new Float64Array(N);
  for(let i=0;i<N;i++) xs[i]=xMin+(xMax-xMin)*i/(N-1);
  const theta=(x,t)=> state.k*x - state.w*t;

  // Potentials
  function potentials(gauge,t){
    const V=new Float64Array(N), Ax=new Float64Array(N), Ay=new Float64Array(N);
    for(let i=0;i<N;i++){
      const th = theta(xs[i], t);
      if(gauge==='coulomb'){
        V[i]=0; Ax[i]=0; Ay[i]=(state.E0/state.w)*Math.sin(th);
      }else{ // lorenz
        V[i]= -state.alpha*state.w*Math.sin(th);
        Ax[i]= -state.alpha*state.k*Math.sin(th);
        Ay[i]=(state.E0/state.w)*Math.sin(th);
      }
    }
    return {V,Ax,Ay};
  }

  // Fields computed from potentials (here reduce to analytic forms)
  function fieldsFrom(gauge,t){
    // E_y = -∂t A_y = E0 cosθ,  B_z = ∂x A_y = (E0/c) cosθ, independent of gauge
    const Ey=new Float64Array(N), Bz=new Float64Array(N);
    for(let i=0;i<N;i++){
      const th = theta(xs[i], t);
      Ey[i]= state.E0*Math.cos(th);
      Bz[i]= (state.E0/c)*Math.cos(th);
    }
    return {Ey,Bz};
  }

  // Drawing helpers
  function clear(ctx){ ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height); }
  function mapX(x,W){ return 40 + (x - xMin)*(W-60)/(xMax-xMin); }
  function mapY(y,yMin,yMax,H){ return 10 + (yMax - y)*(H-40)/(yMax - yMin); }
  function maxAbs(arr){ let m=0; for(const v of arr){ const a=Math.abs(v); if(a>m)m=a; } return m; }
  function drawAxes(ctx,yMin,yMax){ const W=ctx.canvas.width,H=ctx.canvas.height; ctx.save();
    ctx.strokeStyle=COL.grid; ctx.lineWidth=1; ctx.beginPath();
    for(let gx=0;gx<=10;gx++){ const x=40+(W-60)*gx/10; ctx.moveTo(x,10); ctx.lineTo(x,H-30); }
    for(let gy=0;gy<=6;gy++){ const y=10+(H-40)*gy/6; ctx.moveTo(40,y); ctx.lineTo(W-20,y); }
    ctx.stroke(); const y0=mapY(0,yMin,yMax,H); ctx.strokeStyle=COL.zero; ctx.beginPath(); ctx.moveTo(40,y0); ctx.lineTo(W-20,y0); ctx.stroke(); ctx.restore(); }
  function drawLine(ctx,ys,color,yMin,yMax){ const W=ctx.canvas.width,H=ctx.canvas.height; ctx.save(); ctx.strokeStyle=color; ctx.lineWidth=2; ctx.beginPath();
    for(let i=0;i<N;i++){ const X=mapX(xs[i],W); const Y=mapY(ys[i],yMin,yMax,H); if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);} ctx.stroke(); ctx.restore(); }

  // Panel renderer
  function renderPanel(ctx, gauge, view, fieldWhich, potWhich, legendEl){
    clear(ctx);
    if(view==='fields'){
      const {Ey,Bz}=fieldsFrom(gauge,state.t);
      const ydata = (fieldWhich==='Ey')? Ey : Bz;
      const sym = (fieldWhich==='Ey') ? 'E<sub>y</sub>' : 'B<sub>z</sub>';
      legendEl.innerHTML = sym + ' — ' + (gauge==='coulomb'?'Coulomb':'Lorenz');
      const amp=Math.max(1,maxAbs(ydata)); const yMax=Math.max(1,amp*1.2), yMin=-yMax;
      drawAxes(ctx,yMin,yMax); drawLine(ctx,ydata, fieldWhich==='Ey'?COL.E:COL.B, yMin,yMax);
    } else {
      const {V,Ax,Ay}=potentials(gauge,state.t);
      let ydata,label;
      if(potWhich==='V'){ ydata=V; label='V — ' + (gauge==='coulomb'?'Coulomb':'Lorenz'); }
      else if(potWhich==='Ax'){ ydata=Ax; label='A<sub>x</sub> — ' + (gauge==='coulomb'?'Coulomb':'Lorenz'); }
      else { ydata=Ay; label='A<sub>y</sub> — ' + (gauge==='coulomb'?'Coulomb':'Lorenz'); }
      legendEl.innerHTML = label;
      const amp=Math.max(1e-6,maxAbs(ydata)); const yMax=Math.max(1,amp*1.2), yMin=-yMax;
      drawAxes(ctx,yMin,yMax); drawLine(ctx,ydata, COL.POT, yMin,yMax);
    }
  }

  function updateSelectors(viewSel, fieldSel, potSel){
    const v=viewSel.value; fieldSel.style.display = (v==='fields')?'inline-block':'none'; potSel.style.display = (v==='potentials')?'inline-block':'none';
  }

  // Events
  tRange.addEventListener('input', e=>{ state.t=parseFloat(e.target.value); drawAll(); });
  playBtn.addEventListener('click', ()=>{ state.playing=!state.playing; playBtn.setAttribute('aria-pressed', state.playing); playBtn.textContent= state.playing? 'Pause':'Play'; state.last=performance.now(); if(state.playing) requestAnimationFrame(tick); });
  speedEl.addEventListener('change', e=>{ const v=parseFloat(e.target.value); state.speed = (!isNaN(v)&&v>0)? v:1.0; e.target.value=state.speed; });
  E0El.addEventListener('change', e=>{ const v=parseFloat(e.target.value); state.E0 = isNaN(v)?1.0:v; e.target.value=state.E0; drawAll(); });
  kEl.addEventListener('change', e=>{ const v=parseFloat(e.target.value); state.k = (!isNaN(v)&&v>0)? v:1.0; e.target.value=state.k; drawAll(); });

  // Panel-specific events
  viewC.addEventListener('change', ()=>{ updateSelectors(viewC, fieldSelC, potSelC); drawAll(); });
  fieldWhichC.addEventListener('change', drawAll);
  potWhichC.addEventListener('change', drawAll);

  viewL.addEventListener('change', ()=>{ updateSelectors(viewL, fieldSelL, potSelL); drawAll(); });
  fieldWhichL.addEventListener('change', drawAll);
  potWhichL.addEventListener('change', drawAll);

  function tick(now){ if(!state.playing) return; const dt=(now-state.last)/1000; state.last=now; state.t=(state.t + dt*state.speed)%TWO_PI; tRange.value=state.t; drawAll(); requestAnimationFrame(tick); }
  function drawAll(){
    renderPanel(ctxC, 'coulomb', viewC.value, fieldWhichC.value, potWhichC.value, legendC);
    renderPanel(ctxL, 'lorenz',  viewL.value, fieldWhichL.value, potWhichL.value, legendL);
  }

  // init
  updateSelectors(viewC, fieldSelC, potSelC); updateSelectors(viewL, fieldSelL, potSelL);
  drawAll();
})();
</script>

  <script src="../header-loader.js"></script>
</body>
</html>
